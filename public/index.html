<!DOCTYPE html>
<html>
<head>
<title>DBF explorer</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
</head>
<body>
<main class="container">
    <div class="row">
        <div class="col-3">
            <div id="file_list" style="overflow-y:auto;height:500px;"></div>
        </div>
        <div class="col-9">
            <div id="file_table"></div>
        </div>
    </div>
</main>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
$(document).ready(function() {
    $.ajax({
        url: '/api/files',
        dataType: 'JSON',
        success: function(response) {
            let fileList = $('#file_list');
            fileList.html('');
            for (let i in response) {
                fileList.append('<div><a href="#file=' + response[i] + '">' + response[i] + '</a></div>');
            }
        }
    });

    // check hesh
    let lastHash = '';
    setInterval(() => {
        let newHash = location.hash;
        if (newHash !== lastHash) {
            $.ajax({
                url: '/api/table/' + newHash.replace('#file=', ''),
                dataType: 'JSON',
                success: function(response) {
                    let table = $('<table/>');
                    
                    for (let i in response) {
                        let item = response[i];
                        let row = $('<tr/>');
                        
                        for (let j in item) {
                            let col = $('<td/>');
                            col.html(item[j]);
                            row.append(col);
                        }
                        
                        table.append(row);
                    }
                    console.log(response);
                    $('#file_table').html(table);
                }
            });
            lastHash = newHash;
        }
    }, 500);
});
</script>
</body>
</html>